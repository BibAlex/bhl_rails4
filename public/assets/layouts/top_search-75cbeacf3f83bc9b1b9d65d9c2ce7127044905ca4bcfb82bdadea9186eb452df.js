bhlApp.controller("topSearch",["$scope","$window","$log",function(e,r,t){e.searchBy="title",e.init_i18n_alerts=function(r,t){e.invalidInputWarn=r,e.emptySearchQueryWarn=t},e.updateSearchQuery=function(r){e.searchQuery=r},e.search=function(){if("undefined"==typeof e.searchQuery)return void e.alertEmptySearchError();if(e.searchQuery=r.clearString(e.searchQuery),console.log(e.searchQuery),""==e.searchQuery)return void e.alertEmptySearchError();var t=e.extractPreviousSearchQuery(),o="",a=!1;for(var n in t)""!=o&&(o+="&"),t[n].type=="_"+e.searchBy&&(t[n].keyword+="_or_"+e.searchQuery,a=!0),o+=t[n].type+"="+t[n].keyword;a||(""!=o&&(o+="&"),o+="_"+e.searchBy+"="+e.searchQuery),window.location=window.location.protocol+"//"+window.location.host+"/"+document.documentElement.lang+"/books?"+o},e.alertEmptySearchError=function(){r.sweetAlert(e.invalidInputWarn,e.emptySearchQueryWarn,"error")},e.extractPreviousSearchQuery=function(){var e=location.href.toLowerCase(),r=e.split("?")[0];if(r!=window.location.protocol+"//"+window.location.host+"/books")return[];var t=e.split("?")[1].split("&"),o=[];for(var a in t){var n={type:t[a].split("=")[0],keyword:t[a].split("=")[1]};o.push(n)}return o},e.searchKeyPress=function(r){13===r.which?e.search():!1}}]),$(document).ready(function(){var e;return e={},$("#headerSearchField").autocomplete({minLength:2,source:function(r,t){var o;return o=r.term,o in e?void t(e[o]):(search_by=$("#headerSearchBy").val(),"content"!=search_by&&"all"!=search_by?(searchfield=$("#headerSearchField").val(),$.getJSON("/en/books/autocomplete?type="+search_by,r,function(r,a,n){return e[o]=r,t(r)})):void 0)},select:function(e,r){var t=r.item.value,o=angular.element(document.getElementById("topsearch")).scope();o.$apply(function(){o.updateSearchQuery(t)})}})});