$(document).ready(function() {
    autocomplete();
  });

function searchfnc(searchquery, e, field){
    if(field == null || field == ''){
      alert("<%= I18n.t('warn.empty_search_query_warn') %>");
      return;
    }
    
    if ([' ',  '!', '@', '#', '$' , '^', '&', '*', '(',  ',',  ')', '_',  '+', '-', '=' , '&', '%'].indexOf(field) >= 0 || field.indexOf("%") >= 0) {
     alert("<%= I18n.t('warn.invalid_input') %>");
     return;
    }
    
    url = window.location.href.split('?')[0];
    url = url.split('#')[0];  
    var type = e.options[e.selectedIndex].value;
    if(url == window.location.protocol + "//" + window.location.host + "/books"){
      if(searchquery == null || searchquery == '' || searchquery == '*:*'){
        searchquery = "_" + type + "=" + field;
      } 
      else if(searchquery.toLowerCase().indexOf("_" + type.toLowerCase()) != -1){
        searchquery = searchquery.replace("_" + type.toLowerCase() + "=","_" + type.toLowerCase() + "=" + field + " _AND ");
      }
      else{
        searchquery += "&_" + type + "=" + field;
      }
      window.location = url + "?" + searchquery;
    }
    else{
      searchquery = "_" + type + "=" + field;
      window.location = window.location.protocol + "//" + window.location.host + "/books" + "?" + searchquery;
    }
  }
  
function autocomplete()
{
    var cache;
    cache = {};
    return $("#headersearchfield").autocomplete({
      minLength: 2,
      source: function(request, response) {
        var term;
        term = request.term;
        if (term in cache) {
          response(cache[term]);
          return;
        }
        search_by = $("#headersearchby").val();
        searchfield = $("#headersearchfield").val();
        return $.getJSON("/<%= I18n.locale %>/books/autocomplete?type=" + search_by, request, function(data, status, xhr) {
          cache[term] = data;
          return response(data);
        });
      }
    });
  
}
